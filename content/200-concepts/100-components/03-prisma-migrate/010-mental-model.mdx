---
title: 'Prisma Migrate Mental Models'
metaTitle: 'Prisma Migrate Mental Models'
metaDescription: 'Prisma Migrate Mental Models'
tocDepth: 2
---

## Fundamentals of database migrations

### What are database migrations

Migrations are a controlled set of changes that modify the structure of objects within your database. Migrations help you transition your database schema from one state to another, for example, creating or removing tables and columns, splitting fields in a table, or adding types and constraints to your database.

Migrations are important when working with databases because they provide a systematic way to evolve the database schema.

### Evolving database schemas

There are two main patterns in you can incrementally update your database schema:

- **Database first** — involves defining the structure of your database and applying it to your database using SQL and then _introspecting_ the database to generate the code that describes the structure of your database to sync your application and database schema

![Introspect your database with Prisma](https://res.cloudinary.com/prismaio/image/upload/v1628761155/docs/f7itiYw.png)

- **Code first** — involves defining the structure of the database schema using code and then using a migration tool to generate the SQL, for example, for syncing your application and database schema

![](https://user-images.githubusercontent.com/33921841/188153036-2095e6d3-a0a7-43f2-9c42-110dc0ccd8b1.jpg)

Artifacts describing schema updates would ideally be stored together with your application code. It would also be tracked in version control and shared with the rest of the team working on the application.

Migrations provide _state management_ which helps with tracking the state of the database.

Migrations also allow you to replicate the state of a database at a specific point in time which is useful when collaborating with other members of the team, e.g. switching between different branches.

For further details on what database migrations are, see the [Prisma Data Guide](https://www.prisma.io/dataguide/types/relational/what-are-database-migrations).

## What is Prisma Migrate

Prisma Migrate is a database migration tool that supports _code first_ and _database first_ patterns for managing database schemas from your local environment to production.

The workflow when using Prisma Migrate in your project would be iterative and look like this:

- Define your Prisma schema – the source of truth
- Use one of the Prisma CLI commands to sync your Prisma schema with the database schema

**TODO**: image showing an iterative process for different environments

Prisma Migrate uses the following pieces of state to track the state of your database schema:

- **Prisma schema**: the main configuration file (data source, generators, and data models)
- **Migrations history**: the history of changes made to your database schema represented in the`prisma/migrations` folder
  - EXAMPLE
- **Migrations table**: table in the database that stores metadata of the already applied migrations (`_prisma_migrations`)
  - EXAMPLE
- **Database schema**: the _state_ of the database

**TODO**: add image showing where each piece fits in the application stack 👆🏽

## Evolving your database schema with Prisma Migrate

### Assumptions

- Ideally, you should use different databases for different environments, i.e. a separate database for development, preview, and production environments
- The database used in developments environment are disposable — you can easily create, use, and delete on demand.
- The database configuration used in different environment should be similar to ensure it's reproducible.

- The Prisma schema serves as the source of truth — describing the shape of your [database schema](https://www.prisma.io/dataguide/intro/database-glossary#schema).

### Concepts

- [Schema drift](https://www.prisma.io/docs/guides/database/developing-with-prisma-migrate/troubleshooting-development#schema-drift): occurs when your database schema is out of sync with your migrations history and migrations table.

### Development environments

#### Schema Prototyping

Prisma Migrate provides `db push` that allows you to sync your Prisma schema and database schema without persisting a migration (`/prisma/migrations`).

`db push` uses the **Prisma schema** and the **database schema** to track the database state.

**TODO**: image for process

`db push` is useful for quickly prototyping and iterating on your database schema and prioritizing a desired-end state for your database schema.

`db push` will prompt you to reset your database if it detects a schema drift. For example when you add a required field to a table with existing content without providing a default value.

#### Tracking migration histories

When you're interested in tracking the changes you're making to your database, Prisma Migrate provides `migrate dev`.

`migrate dev` automatically generates SQL migration files (saved in `/prisma/migrations`) and applies them to the database. When a migration is applied to the database, the migrations table (`_prisma_migrations`) in your database is also updated.

**TODO**: image for process

Prisma `migrate dev` tracks the database' state using the:

- Prisma schema
- Migrations history
- Migrations table
- Database schema

`migrate dev` also allows you to customize migrations before applying them to the database using the `--create-only` flag. You might want to edit a migration in situations where you would like to rename columns without incurring any data loss or loading database extensions (in PostgreSQL) and database views.

**TODO**: illustration for this process

To learn what `migrate dev` does under the hood, refer to **TODO: link to illustration/ page with illustration**.

> **Note**: `migrate dev` is intended to be used only in development with a disposable database.

If `migrate dev` detects a schema drift or a migration history conflict, you will be prompted to reset your database — drop and recreate your database — to sync the migration history and the database schema.

**TODO**: image for process?

#### Resolving schema drifts

A schema drift might occur when the expected database schema is different from what is in the migration history. Example instances where this might occur is when you manually update the database schema.

For such instances, `migrate diff` can help you compare your migration history and the database schema.

**TODO:** image showing what this looks like

You can use `migrate diff` to generate the SQL that can either:

- Reverts the changes made in the database schema
- Move your database schema forward to apply missing changes

You can then apply the changes to your database using `db execute`.

**TODO:** image for process

### Production and preview (staging and testing) environments

#### Syncing Migration Histories

You can sync your migration history (from your development environment) with your database (in the preview or production environment) using `migrate deploy`.

Under the hood `migrate deploy`:

- Compare already applied migrations (in `_prisma_migrations`) and the migration history
- Apply pending migrations
- Update `_prisma_migrations` table with the new migrations

**TODO**: add image to show the process

The command should be run in an automated CI/ CD environment, for example GitHub Actions. (link to example?)
